<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maruf Hasan | Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* [All your existing CSS remains exactly the same] */
    :root {
      --bg-start: #0e111a;
      --bg-end: #1c1f2e;
      --glass-bg: rgba(255, 255, 255, 0.03);
      --accent: #55d0ff;
      --text: #fff;
      --muted: #a0a4b8;
      --radius: 18px;
      --border: rgba(255, 255, 255, 0.08);
      --error: #ff6b6b;
      --section-bg: rgba(22, 26, 34, 0.95);
      --accent-gradient: linear-gradient(135deg, #55d0ff 0%, #2a9ef4 100%);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to bottom, var(--bg-start), var(--bg-end));
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 72px;
      position: relative;
      overflow-x: hidden;
    }

    /* [Rest of your CSS remains exactly the same] */
    /* ... */

  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="balance-container">
      <div class="balance">
        <img class="ton-icon" src="https://ton.org/icons/custom/ton_logo.svg" alt="TON">
        <span class="balance-amount">0</span>
        <span class="balance-currency">TON</span>
      </div>
    </div>
    <div class="action-buttons">
      <button class="deposit-btn" id="showDeposit">
        <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Deposit
      </button>
      <button class="withdraw-btn" id="showWithdraw">
        <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Withdraw
      </button>
    </div>
  </div>

  <!-- Profile Card -->
  <div class="profile-card">
    <div class="profile-info">
      <div class="profile-avatar">
        <img id="userAvatar" src="" alt="Profile Photo">
      </div>
      <div>
        <div class="profile-name" id="userName">Loading...</div>
        <div class="profile-telegram" id="userUsername"></div>
      </div>
    </div>
    <div class="profile-stats">
      <div class="stat">
        <div class="stat-value">
          <img class="ton-icon" src="https://ton.org/icons/custom/ton_logo.svg" alt="TON" style="width: 16px; height: 16px;">
          0.00
        </div>
        <div class="stat-label">Total Volume</div>
      </div>
      <div class="stat">
        <div class="stat-value">
          <img class="ton-icon" src="https://ton.org/icons/custom/ton_logo.svg" alt="TON" style="width: 16px; height: 16px;">
          0
        </div>
        <div class="stat-label">Portfolio</div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="collections">Collections</button>
    <button class="tab" data-tab="roadmap">Roadmap</button>
  </div>

  <!-- Collections Section -->
  <div class="content-section" id="collectionsSection">
    <div class="section-title">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      Your Collections
    </div>
    <div class="empty-state">
      <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
      <div class="empty-text">No collections available</div>
      <div class="empty-subtext">Send your sticker to market to see it here</div>
    </div>
  </div>

  <!-- Roadmap Section -->
  <div class="content-section" id="roadmapSection" style="display: none;">
    <div class="section-title">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      Getting Started
    </div>
    <div class="roadmap-steps">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-text">Press Start</div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-text">Send your sticker to @palacerelayer in @sticker_bot</div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-text">Top up your wallet with 0.1 TON to activate it</div>
      </div>
      <div class="step">
        <div class="step-number">4</div>
        <div class="step-text">Now you can list your sticker on the marketplace!</div>
      </div>
    </div>
  </div>

  <!-- Deposit Overlay -->
  <div class="deposit-overlay" id="depositOverlay">
    <div class="deposit-box">
      <div class="deposit-header">
        <h2 class="deposit-title">Deposit</h2>
        <button class="close-btn" id="closeDeposit">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <p class="deposit-instructions">Transfer TON from your wallet to the address:</p>
      
      <div class="address-container">
        <div class="wallet-address" id="walletAddress">UQBiasMod...f5eSDEitj</div>
        <button class="copy-btn" id="copyBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
      </div>
      
      <p class="deposit-instructions">After making the transfer, it may take a few minutes to reflect in your balance.</p>
      
      <button class="confirm-btn" id="confirmDeposit">I've Sent the TON</button>
    </div>
  </div>

  <!-- Withdraw Overlay -->
  <div class="withdraw-overlay" id="withdrawOverlay">
    <div class="withdraw-box">
      <div class="withdraw-header">
        <h2 class="withdraw-title">Withdraw</h2>
        <button class="close-btn" id="closeWithdraw">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <p class="withdraw-instructions">Enter the amount and wallet address to withdraw your TON.</p>
      
      <div class="input-group">
        <label class="input-label">Amount (TON)</label>
        <input type="number" class="input-field" id="withdrawAmount" placeholder="0.0" step="0.01" min="0">
        <div class="error-message" id="amountError">Please enter a valid amount</div>
      </div>
      
      <div class="input-group">
        <label class="input-label">Wallet Address</label>
        <input type="text" class="input-field" id="withdrawAddress" placeholder="UQB...">
        <div class="error-message" id="addressError">Please enter a valid address</div>
      </div>
      
      <button class="action-btn" id="confirmWithdraw">Withdraw</button>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">Copied to clipboard!</div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <a href="market.html" class="nav-item">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <circle cx="9" cy="21" r="1"></circle>
        <circle cx="20" cy="21" r="1"></circle>
        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
      </svg>
      Market
    </a>
    <a href="profile.html" class="nav-item active">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      Profile
    </a>
    <a href="activity.html" class="nav-item">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
      </svg>
      Activity
    </a>
  </div>

  <script>
    // Initialize Telegram WebApp
    const tg = window.Telegram.WebApp;
    tg.expand(); // Expand to full screen

    // Function to set user data with multiple fallback mechanisms
    function setUserData() {
      // Try to get user data from Telegram WebApp first
      const user = tg.initDataUnsafe?.user;
      
      if (user) {
        // Set user name
        const userNameElement = document.getElementById('userName');
        const name = `${user.first_name || ''} ${user.last_name || ''}`.trim();
        userNameElement.textContent = name || 'Telegram User';
        
        // Set username if available
        const userUsernameElement = document.getElementById('userUsername');
        if (user.username) {
          userUsernameElement.textContent = user.username;
          userUsernameElement.style.display = 'flex';
        } else {
          userUsernameElement.style.display = 'none';
        }
        
        // Set avatar if available
        const userAvatarElement = document.getElementById('userAvatar');
        if (user.photo_url) {
          userAvatarElement.src = user.photo_url;
        } else {
          // Default avatar if no photo
          userAvatarElement.src = 'https://via.placeholder.com/64';
        }
        
        // Save to localStorage for future navigation
        const userData = {
          name: name,
          username: user.username || '',
          photo_url: user.photo_url || ''
        };
        localStorage.setItem('telegramUser', JSON.stringify(userData));
        
        return true;
      } else {
        // Fallback 1: Check localStorage for saved data
        const savedUser = localStorage.getItem('telegramUser');
        if (savedUser) {
          try {
            const user = JSON.parse(savedUser);
            document.getElementById('userName').textContent = user.name || 'Telegram User';
            const usernameElement = document.getElementById('userUsername');
            usernameElement.textContent = user.username || '';
            usernameElement.style.display = user.username ? 'flex' : 'none';
            document.getElementById('userAvatar').src = user.photo_url || 'https://via.placeholder.com/64';
            return true;
          } catch (e) {
            console.error('Error parsing saved user data', e);
          }
        }
        
        // Fallback 2: Check URL parameters (if coming from another page)
        const urlParams = new URLSearchParams(window.location.search);
        const paramUser = urlParams.get('user');
        if (paramUser) {
          try {
            const user = JSON.parse(decodeURIComponent(paramUser));
            document.getElementById('userName').textContent = user.name || 'Telegram User';
            const usernameElement = document.getElementById('userUsername');
            usernameElement.textContent = user.username || '';
            usernameElement.style.display = user.username ? 'flex' : 'none';
            document.getElementById('userAvatar').src = user.photo_url || 'https://via.placeholder.com/64';
            return true;
          } catch (e) {
            console.error('Error parsing URL user data', e);
          }
        }
        
        // Final fallback if no data available
        document.getElementById('userName').textContent = 'Telegram User';
        document.getElementById('userUsername').textContent = '';
        document.getElementById('userUsername').style.display = 'none';
        document.getElementById('userAvatar').src = 'https://via.placeholder.com/64';
        return false;
      }
    }

    // Save user data before navigation
    function setupNavigationGuards() {
      document.querySelectorAll('a').forEach(link => {
        if (link.href && !link.href.startsWith('http') && !link.href.startsWith('mailto')) {
          link.addEventListener('click', (e) => {
            const user = tg.initDataUnsafe?.user;
            if (user) {
              const userData = {
                name: `${user.first_name || ''} ${user.last_name || ''}`.trim(),
                username: user.username || '',
                photo_url: user.photo_url || ''
              };
              localStorage.setItem('telegramUser', JSON.stringify(userData));
              
              // If navigating to another page in our app, pass the user data
              if (link.href.endsWith('.html')) {
                e.preventDefault();
                window.location.href = `${link.href}?user=${encodeURIComponent(JSON.stringify(userData))}`;
              }
            }
          });
        }
      });
    }

    // Initialize everything when page loads
    document.addEventListener('DOMContentLoaded', () => {
      // First try to set user data
      setUserData();
      
      // Set up navigation guards
      setupNavigationGuards();
      
      // Set up tab switching
      const tabs = document.querySelectorAll('.tab');
      const sections = {
        collections: document.getElementById('collectionsSection'),
        roadmap: document.getElementById('roadmapSection')
      };

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          Object.values(sections).forEach(section => {
            section.style.display = 'none';
          });
          
          const tabName = tab.getAttribute('data-tab');
          sections[tabName].style.display = 'block';
        });
      });

      // Set up overlay functionality
      const depositOverlay = document.getElementById('depositOverlay');
      const withdrawOverlay = document.getElementById('withdrawOverlay');
      const showDepositBtn = document.getElementById('showDeposit');
      const showWithdrawBtn = document.getElementById('showWithdraw');
      const closeDepositBtn = document.getElementById('closeDeposit');
      const closeWithdrawBtn = document.getElementById('closeWithdraw');
      const copyBtn = document.getElementById('copyBtn');
      const notification = document.getElementById('notification');

      showDepositBtn.addEventListener('click', () => {
        depositOverlay.classList.add('active');
      });

      showWithdrawBtn.addEventListener('click', () => {
        withdrawOverlay.classList.add('active');
      });

      closeDepositBtn.addEventListener('click', () => {
        depositOverlay.classList.remove('active');
      });

      closeWithdrawBtn.addEventListener('click', () => {
        withdrawOverlay.classList.remove('active');
      });

      copyBtn.addEventListener('click', () => {
        const address = document.getElementById('walletAddress').textContent;
        navigator.clipboard.writeText(address).then(() => {
          notification.classList.add('show');
          setTimeout(() => {
            notification.classList.remove('show');
          }, 2000);
        });
      });
    });

    // Handle cases where page is shown from cache (like back button)
    window.addEventListener('pageshow', (event) => {
      if (event.persisted) {
        setUserData();
      }
    });
  </script>
</body>
</html>